@model MRIV.Models.UserProfile

@{
    ViewData["Title"] = "User Profile Debug";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<div class="container-fluid mt-4">
    <div class="row">
        <div class="col-12">
            <div class="card">
                <div class="card-header bg-info text-white">
                    <h4 class="mb-0">
                        <i class="fas fa-bug"></i> User Profile Debug Information
                    </h4>
                </div>
                <div class="card-body">
                    @if (Model != null)
                    {
                        <div class="alert alert-success">
                            <i class="fas fa-check-circle"></i> User Profile Created Successfully
                        </div>

                        <!-- Basic Information -->
                        <div class="row mb-4">
                            <div class="col-md-6">
                                <div class="card border-primary">
                                    <div class="card-header bg-primary text-white">
                                        <h5 class="mb-0">Basic Information</h5>
                                    </div>
                                    <div class="card-body">
                                        <table class="table table-sm">
                                            <tr><td><strong>Payroll No:</strong></td><td>@Model.BasicInfo.PayrollNo</td></tr>
                                            <tr><td><strong>Full Name:</strong></td><td>@Model.BasicInfo.Fullname</td></tr>
                                            <tr><td><strong>Email:</strong></td><td>@Model.BasicInfo.EmailAddress</td></tr>
                                            <tr><td><strong>Designation:</strong></td><td>@Model.BasicInfo.Designation</td></tr>
                                            <tr><td><strong>Role:</strong></td><td>@Model.BasicInfo.Role</td></tr>
                                            <tr><td><strong>Department:</strong></td><td>@Model.BasicInfo.Department</td></tr>
                                            <tr><td><strong>Station:</strong></td><td>@Model.BasicInfo.Station</td></tr>
                                            <tr><td><strong>Is Active:</strong></td><td>@Model.BasicInfo.IsActive</td></tr>
                                        </table>
                                    </div>
                                </div>
                            </div>

                            <!-- Role Information -->
                            <div class="col-md-6">
                                <div class="card border-success">
                                    <div class="card-header bg-success text-white">
                                        <h5 class="mb-0">Role Information</h5>
                                    </div>
                                    <div class="card-body">
                                        <table class="table table-sm">
                                            <tr><td><strong>System Role:</strong></td><td>@Model.RoleInformation.SystemRole</td></tr>
                                            <tr><td><strong>Is Admin:</strong></td><td>@Model.RoleInformation.IsAdmin</td></tr>
                                            <tr><td><strong>Role Groups:</strong></td><td>@Model.RoleInformation.RoleGroups.Count</td></tr>
                                        </table>
                                        
                                        @if (Model.RoleInformation.RoleGroups.Any())
                                        {
                                            <h6>Role Groups:</h6>
                                            <ul class="list-group list-group-flush">
                                                @foreach (var roleGroup in Model.RoleInformation.RoleGroups)
                                                {
                                                    <li class="list-group-item">
                                                        <strong>@roleGroup.Name</strong>
                                                        <br><small class="text-muted">@roleGroup.Description</small>
                                                        <br><small>Cross Dept Access: @roleGroup.CanAccessAcrossDepartments | Cross Station Access: @roleGroup.CanAccessAcrossStations</small>
                                                    </li>
                                                }
                                            </ul>
                                        }
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Location Access -->
                        <div class="row mb-4">
                            <div class="col-12">
                                <div class="card border-warning">
                                    <div class="card-header bg-warning text-dark">
                                        <h5 class="mb-0">Location Access Information</h5>
                                    </div>
                                    <div class="card-body">
                                        <div class="row">
                                            <div class="col-md-4">
                                                <h6>Home Department</h6>
                                                <table class="table table-sm">
                                                    <tr><td><strong>ID:</strong></td><td>@Model.LocationAccess.HomeDepartment.Id</td></tr>
                                                    <tr><td><strong>Code:</strong></td><td>@Model.LocationAccess.HomeDepartment.Code</td></tr>
                                                    <tr><td><strong>Name:</strong></td><td>@Model.LocationAccess.HomeDepartment.Name</td></tr>
                                                </table>
                                            </div>
                                            <div class="col-md-4">
                                                <h6>Home Station</h6>
                                                <table class="table table-sm">
                                                    <tr><td><strong>ID:</strong></td><td>@Model.LocationAccess.HomeStation.Id</td></tr>
                                                    <tr><td><strong>Name:</strong></td><td>@Model.LocationAccess.HomeStation.Name</td></tr>
                                                    <tr><td><strong>Original Name:</strong></td><td>@Model.LocationAccess.HomeStation.OriginalName</td></tr>
                                                    <tr><td><strong>Category:</strong></td><td>@Model.LocationAccess.HomeStation.Category.Code (@Model.LocationAccess.HomeStation.Category.Name)</td></tr>
                                                </table>
                                            </div>
                                            <div class="col-md-4">
                                                <h6>Hierarchy</h6>
                                                <table class="table table-sm">
                                                    <tr><td><strong>HOD:</strong></td><td>@Model.LocationAccess.Hierarchy.HeadOfDepartment (@Model.LocationAccess.Hierarchy.HeadOfDepartmentName)</td></tr>
                                                    <tr><td><strong>Supervisor:</strong></td><td>@Model.LocationAccess.Hierarchy.Supervisor (@Model.LocationAccess.Hierarchy.SupervisorName)</td></tr>
                                                </table>
                                            </div>
                                        </div>

                                        <h6 class="mt-3">Accessible Departments (@Model.LocationAccess.AccessibleDepartments.Count)</h6>
                                        @if (Model.LocationAccess.AccessibleDepartments.Any())
                                        {
                                            <div class="table-responsive">
                                                <table class="table table-sm table-striped">
                                                    <thead>
                                                        <tr>
                                                            <th>ID</th>
                                                            <th>Code</th>
                                                            <th>Name</th>
                                                        </tr>
                                                    </thead>
                                                    <tbody>
                                                        @foreach (var dept in Model.LocationAccess.AccessibleDepartments.Take(10))
                                                        {
                                                            <tr>
                                                                <td>@dept.Id</td>
                                                                <td>@dept.Code</td>
                                                                <td>@dept.Name</td>
                                                            </tr>
                                                        }
                                                    </tbody>
                                                </table>
                                                @if (Model.LocationAccess.AccessibleDepartments.Count > 10)
                                                {
                                                    <small class="text-muted">... and @(Model.LocationAccess.AccessibleDepartments.Count - 10) more departments</small>
                                                }
                                            </div>
                                        }

                                        <h6 class="mt-3">Accessible Stations (@Model.LocationAccess.AccessibleStations.Count)</h6>
                                        @if (Model.LocationAccess.AccessibleStations.Any())
                                        {
                                            <div class="table-responsive">
                                                <table class="table table-sm table-striped">
                                                    <thead>
                                                        <tr>
                                                            <th>ID</th>
                                                            <th>Name</th>
                                                            <th>Original Name</th>
                                                            <th>Category</th>
                                                        </tr>
                                                    </thead>
                                                    <tbody>
                                                        @foreach (var station in Model.LocationAccess.AccessibleStations.Take(10))
                                                        {
                                                            <tr>
                                                                <td>@station.Id</td>
                                                                <td>@station.Name</td>
                                                                <td>@station.OriginalName</td>
                                                                <td>@station.Category.Code (@station.Category.Name)</td>
                                                            </tr>
                                                        }
                                                    </tbody>
                                                </table>
                                                @if (Model.LocationAccess.AccessibleStations.Count > 10)
                                                {
                                                    <small class="text-muted">... and @(Model.LocationAccess.AccessibleStations.Count - 10) more stations</small>
                                                }
                                            </div>
                                        }
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Visibility Scope -->
                        <div class="row mb-4">
                            <div class="col-md-6">
                                <div class="card border-info">
                                    <div class="card-header bg-info text-white">
                                        <h5 class="mb-0">Visibility Scope</h5>
                                    </div>
                                    <div class="card-body">
                                        <table class="table table-sm">
                                            <tr><td><strong>Permission Level:</strong></td><td>@Model.VisibilityScope.PermissionLevel</td></tr>
                                            <tr><td><strong>Can Access Across Departments:</strong></td><td>@Model.VisibilityScope.CanAccessAcrossDepartments</td></tr>
                                            <tr><td><strong>Can Access Across Stations:</strong></td><td>@Model.VisibilityScope.CanAccessAcrossStations</td></tr>
                                        </table>
                                    </div>
                                </div>
                            </div>

                            <!-- Cache Information -->
                            <div class="col-md-6">
                                <div class="card border-secondary">
                                    <div class="card-header bg-secondary text-white">
                                        <h5 class="mb-0">Cache Information</h5>
                                    </div>
                                    <div class="card-body">
                                        <table class="table table-sm">
                                            <tr><td><strong>Created At:</strong></td><td>@Model.CacheInfo.CreatedAt.ToString("yyyy-MM-dd HH:mm:ss")</td></tr>
                                            <tr><td><strong>Last Refresh:</strong></td><td>@Model.CacheInfo.LastRefresh.ToString("yyyy-MM-dd HH:mm:ss")</td></tr>
                                            <tr><td><strong>Expires At:</strong></td><td>@Model.CacheInfo.ExpiresAt.ToString("yyyy-MM-dd HH:mm:ss")</td></tr>
                                            <tr><td><strong>Version:</strong></td><td>@Model.CacheInfo.Version</td></tr>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Session Information -->
                        <div class="row mb-4">
                            <div class="col-12">
                                <div class="card border-dark">
                                    <div class="card-header bg-dark text-white">
                                        <h5 class="mb-0">Session Information</h5>
                                    </div>
                                    <div class="card-body">
                                        <table class="table table-sm">
                                            <tr><td><strong>Employee Payroll No:</strong></td><td>@Context.Session.GetString("EmployeePayrollNo")</td></tr>
                                            <tr><td><strong>User Profile Created:</strong></td><td>@Context.Session.GetString("UserProfileCreated")</td></tr>
                                            <tr><td><strong>User Permission Level:</strong></td><td>@Context.Session.GetString("UserPermissionLevel")</td></tr>
                                            <tr><td><strong>Can Access Across Stations:</strong></td><td>@Context.Session.GetString("CanAccessAcrossStations")</td></tr>
                                            <tr><td><strong>Can Access Across Departments:</strong></td><td>@Context.Session.GetString("CanAccessAcrossDepartments")</td></tr>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="text-center">
                            <a href="/Dashboard" class="btn btn-primary btn-lg">
                                <i class="fas fa-tachometer-alt"></i> Go to Dashboard
                            </a>
                            <a href="/Auth/Login" class="btn btn-secondary btn-lg ml-2">
                                <i class="fas fa-sign-in-alt"></i> Back to Login
                            </a>
                        </div>
                    }
                    else
                    {
                        <div class="alert alert-danger">
                            <i class="fas fa-exclamation-triangle"></i> User Profile is NULL - Profile Creation Failed
                        </div>

                        <div class="card border-danger">
                            <div class="card-header bg-danger text-white">
                                <h5 class="mb-0">Session Information</h5>
                            </div>
                            <div class="card-body">
                                <table class="table table-sm">
                                    <tr><td><strong>Employee Payroll No:</strong></td><td>@Context.Session.GetString("EmployeePayrollNo")</td></tr>
                                    <tr><td><strong>User Profile Created:</strong></td><td>@Context.Session.GetString("UserProfileCreated")</td></tr>
                                </table>
                            </div>
                        </div>

                        <div class="text-center mt-3">
                            <a href="/Auth/Login" class="btn btn-primary btn-lg">
                                <i class="fas fa-sign-in-alt"></i> Back to Login
                            </a>
                        </div>
                    }

                    @if (ViewBag.ErrorMessage != null)
                    {
                        <div class="alert alert-danger mt-3">
                            <i class="fas fa-exclamation-triangle"></i> <strong>Error:</strong> @ViewBag.ErrorMessage
                        </div>
                    }

                    @if (ViewBag.DebugInfo != null)
                    {
                        <div class="card border-warning mt-3">
                            <div class="card-header bg-warning text-dark">
                                <h5 class="mb-0">Debug Information</h5>
                            </div>
                            <div class="card-body">
                                <pre>@ViewBag.DebugInfo</pre>
                            </div>
                        </div>
                    }
                </div>
            </div>
        </div>
    </div>
</div>
