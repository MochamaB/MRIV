@using MRIV.Enums
@using MRIV.Helpers
@{
    ViewData["Title"] = "Select Approvers";
    var currentStep = ViewBag.CurrentStep as string;
    @model MRIV.ViewModels.MaterialRequisitionWizardViewModel

}

<div class="row">
    <!-- Personal Details Section -->
    <div class="col-md-10">
        <h4 class="ml-1"><b>Select Approvers and Receivers</b></h4>
        <hr style="border:2px solid black" />
    </div>
</div>
<form asp-controller="MaterialRequisition" asp-action="CreateApprovals">
<div class="row">
    <div class="col-md-12" style="padding:2.0rem 4.0rem">
        <ul class="bullet-line-list">
            @foreach (var step in Model.ApprovalSteps)
            {
                <li>
                    <div class="col-md-10 d-flex justify-content-between">
                        <div class="col-md-10">
                            <h5 class="text-information">
                                <b>@step.StepNumber. @step.ApprovalStep</b>
                            </h5>
                            <hr />
                            <p class="text-muted mb-2 fw-bold">
                                <b>UPDATED ON:</b> @step.CreatedAt.ToString("dd MMM yyyy HH:mm")
                            </p>
                            <p class="text-muted">
                                <b>@(step.ApprovalStep == "Vendor Dispatch" ? "DISPATCH BY:" : "APPROVAL BY:")</b>  
                                @step.EmployeeName (@step.PayrollNo)
                            </p>
                            <!-- Add dropdown for specific steps -->
                            @if (Model.DepartmentEmployees != null &&
                           Model.DepartmentEmployees.TryGetValue(step.ApprovalStep, out var selectList) &&
                           selectList != null &&
                           selectList.Any() &&  @* Add this check *@
                           step.ApprovalStep != "Vendor Dispatch")
                            {
                                <p class="text-muted">
                                    <b>CHANGE TO:</b>
                                    @Html.DropDownList(
                                             $"SelectedEmployee_{step.StepNumber}",
                                             selectList,
                                             "Select Employee",
                                             new { @class = "formcontrol2" }
                                             )
                                </p>
                            }
                            @if (step.ApprovalStep != "Vendor Dispatch")
                            {
                                <p class="text-muted">
                                    <b>DEPARTMENT:</b> @step.DepartmentName
                                </p>
                            }
                            
                           
                            <p class="text-muted">
                                <b>STATUS:</b> 
                                <span class=" ms-2 badge @BadgeHelper.GetApprovalsBadgeClass(step.ApprovalStatus)">
                                    @step.ApprovalStatus
                                </span>
                            </p>
                        </div>
                    </div>
                </li>
            }
            <li>
                    <div class="col-md-10 d-flex justify-content-between">
                        <div class="col-md-10">
                            <h5 class="text-information">
                                <b>Collectors Information</b>
                            </h5>
                            <hr />
                            <div class="col-md-9">
                                    <div class="form-group">
                                        <label class="control-label"> Collected By</label>  <span class="requiredlabel">*</span>
                                        <input type="text" asp-for="Requisition.CollectorName" class="form-control " placeholder="Full Name" value="" />
                                        <span asp-validation-for="Requisition.CollectorName" class="text-danger"></span>
                                    </div>
                                    <div class="form-group">
                                        <label class="control-label"> Collectors ID No</label>  <span class="requiredlabel">*</span>
                                        <input type="number" asp-for="Requisition.CollectorId" class="form-control " placeholder="ID Number" value="" />
                                        <span asp-validation-for="Requisition.CollectorId" class="text-danger"></span>
                                    </div>
                            </div>
                        </div>
                    </div>

            </li>
        </ul>
    </div>
</div>

<partial name="_WizardNavigation" />
</form>